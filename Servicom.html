<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SERVICOM Complaint Form</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto p-4">
        <div class="bg-white rounded-lg shadow-md">
            <!-- Header -->
            <div class="p-6 border-b border-gray-200">
                <h1 class="text-2xl font-bold text-center">SERVICOM Complaint Submission</h1>
                <p class="text-center text-gray-600 mt-2">Please provide detailed information about your complaint</p>
            </div>

            <!-- Alert Messages -->
            <div id="alertContainer" class="hidden mx-6 mt-6">
                <div class="p-4 rounded-md">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"></svg>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium" id="alertTitle"></h3>
                            <div class="mt-2 text-sm" id="alertMessage"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form -->
            <form id="complaintForm" class="p-6 space-y-6">
                <!-- Personal Information -->
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-1">Staff ID *</label>
                        <input type="text" name="staffId" class="w-full p-2 border rounded" required>
                        <span class="text-red-500 text-sm hidden"></span>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1">Full Name *</label>
                        <input type="text" name="fullName" class="w-full p-2 border rounded" required>
                        <span class="text-red-500 text-sm hidden"></span>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-1">Department *</label>
                        <select name="department" class="w-full p-2 border rounded" required>
                            <option value="">Select Department</option>
                            <option value="Registry">Registry</option>
                            <option value="Admin">Admin</option>
                            <option value="Procurement">Procurement</option>
                            <option value="IT Services">IT Services</option>
                            <option value="Human Resources">Human Resources</option>
                            <option value="Finance">Finance</option>
                            <option value="Technical Services">Technical Services</option>
                            <option value="Research & Development">Research & Development</option>
                        </select>
                        <span class="text-red-500 text-sm hidden"></span>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1">Complaint Type *</label>
                        <select name="complaintType" class="w-full p-2 border rounded" required>
                            <option value="">Select Complaint Type</option>
                            <option value="Service Delay">Service Delay</option>
                            <option value="Poor Service Quality">Poor Service Quality</option>
                            <option value="Staff Conduct">Staff Conduct</option>
                            <option value="Process Issues">Process Issues</option>
                            <option value="Facility Problems">Facility Problems</option>
                            <option value="Documentation Issues">Documentation Issues</option>
                            <option value="Other">Other</option>
                        </select>
                        <span class="text-red-500 text-sm hidden"></span>
                    </div>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-1">Email *</label>
                        <input type="email" name="email" class="w-full p-2 border rounded" required>
                        <span class="text-red-500 text-sm hidden"></span>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1">Phone Number *</label>
                        <input type="tel" name="phoneNumber" class="w-full p-2 border rounded" required>
                        <span class="text-red-500 text-sm hidden"></span>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1">Subject *</label>
                    <input type="text" name="subject" class="w-full p-2 border rounded" required>
                    <span class="text-red-500 text-sm hidden"></span>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1">Description *</label>
                    <textarea name="description" rows="5" class="w-full p-2 border rounded" required></textarea>
                    <span class="text-red-500 text-sm hidden"></span>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium mb-1">Priority Level</label>
                        <select name="priority" class="w-full p-2 border rounded">
                            <option value="low">Low</option>
                            <option value="medium" selected>Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-1">Preferred Contact Method</label>
                        <select name="preferredContact" class="w-full p-2 border rounded">
                            <option value="email" selected>Email</option>
                            <option value="phone">Phone</option>
                            <option value="both">Both</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1">Attachments</label>
                    <div class="mt-2">
                        <input type="file" id="fileUpload" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" class="hidden">
                        <label for="fileUpload" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 cursor-pointer">
                            Upload Files
                        </label>
                        <p class="text-sm text-gray-500 mt-1">Maximum file size: 5MB. Accepted formats: PDF, DOC, DOCX, JPG, JPEG, PNG</p>
                        <div id="fileList" class="mt-4 space-y-2"></div>
                    </div>
                </div>

                <div class="flex justify-end gap-4">
                    <button type="reset" class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                        Reset
                    </button>
                    <button type="submit" id="submitButton" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">
                        Submit Complaint
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('complaintForm');
            const fileUpload = document.getElementById('fileUpload');
            const fileList = document.getElementById('fileList');
            const submitButton = document.getElementById('submitButton');
            const alertContainer = document.getElementById('alertContainer');
            const alertTitle = document.getElementById('alertTitle');
            const alertMessage = document.getElementById('alertMessage');

            let files = [];

            function showAlert(type, title, message) {
                alertContainer.className = `mx-6 mt-6 ${type === 'success' ? 'bg-green-50' : 'bg-red-50'}`;
                alertContainer.querySelector('svg').className = `h-5 w-5 ${type === 'success' ? 'text-green-400' : 'text-red-400'}`;
                alertTitle.textContent = title;
                alertMessage.textContent = message;
                alertContainer.classList.remove('hidden');
            }

            function validateEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }

            function validatePhone(phone) {
                return /^\d{11}$/.test(phone.replace(/[^0-9]/g, ''));
            }

            function validateForm() {
                let isValid = true;
                const errorSpans = form.querySelectorAll('span');
                errorSpans.forEach(span => span.classList.add('hidden'));

                // Required fields validation
                ['staffId', 'fullName', 'department', 'complaintType', 'email', 'phoneNumber', 'subject', 'description'].forEach(field => {
                    const input = form[field];
                    const errorSpan = input.nextElementSibling;
                    
                    if (!input.value.trim()) {
                        errorSpan.textContent = `${field.charAt(0).toUpperCase() + field.slice(1)} is required`;
                        errorSpan.classList.remove('hidden');
                        isValid = false;
                    }
                });

                // Email validation
                if (form.email.value && !validateEmail(form.email.value)) {
                    const errorSpan = form.email.nextElementSibling;
                    errorSpan.textContent = 'Invalid email format';
                    errorSpan.classList.remove('hidden');
                    isValid = false;
                }

                // Phone validation
                if (form.phoneNumber.value && !validatePhone(form.phoneNumber.value)) {
                    const errorSpan = form.phoneNumber.nextElementSibling;
                    errorSpan.textContent = 'Invalid phone number format (11 digits required)';
                    errorSpan.classList.remove('hidden');
                    isValid = false;
                }

                // Description length validation
                if (form.description.value.length < 50) {
                    const errorSpan = form.description.nextElementSibling;
                    errorSpan.textContent = 'Description must be at least 50 characters';
                    errorSpan.classList.remove('hidden');
                    isValid = false;
                }

                return isValid;
            }

            fileUpload.addEventListener('change', function(e) {
                const newFiles = Array.from(e.target.files);
                const maxSize = 5 * 1024 * 1024; // 5MB
                const validFiles = newFiles.filter(file => {
                    const isValidSize = file.size <= maxSize;
                    const isValidType = /\.(pdf|doc|docx|jpg|jpeg|png)$/i.test(file.name);
                    return isValidSize && isValidType;
                });

                if (validFiles.length !== newFiles.length) {
                    showAlert('error', 'File Error', 'Some files were rejected. Please ensure files are under 5MB and in the correct format.');
                }

                files = [...files, ...validFiles];
                updateFileList();
            });

            function updateFileList() {
                fileList.innerHTML = files.map((file, index) => `
                    <div class="flex items-center justify-between p-2 bg-gray-50 rounded">
                        <span class="text-sm truncate">${file.name}</span>
                        <button type="button" data-index="${index}" class="text-red-500 hover:text-red-700">
                            Remove
                        </button>
                    </div>
                `).join('');

                // Add event listeners to remove buttons
                fileList.querySelectorAll('button').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.dataset.index);
                        files.splice(index, 1);
                        updateFileList();
                    });
                });
            }

            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                if (!validateForm()) {
                    showAlert('error', 'Validation Error', 'Please check the form for errors and try again.');
                    return;
                }

                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="animate-spin">⌛</span> Submitting...';

                try {
                    // Simulate form submission
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    showAlert('success', 'Success', 'Your complaint has been successfully submitted. You will receive a confirmation email with tracking details.');
                    form.reset();
                    files = [];
                    updateFileList();
                    alertContainer.scrollIntoView({ behavior: 'smooth' });
                } catch (error) {
                    showAlert('error', 'Error', 'Failed to submit the complaint. Please try again.');
                } finally {
                    submitButton.disabled = false;
                    submitButton.textContent = 'Submit Complaint';
                }
            });

            form.addEventListener('reset', function() {
                files = [];
                updateFileList();
                const errorSpans = form.querySelectorAll('span');
                errorSpans.forEach(span => span.classList.add('hidden'));
                alertContainer.classList.add('hidden');
            });
        });
    </script>
</body>
</html>